<!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Or√ßamento Gr√°fico DIGRA</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #1E3A8A 0%, #6D28D9 100%);
            color: #333;
            min-height: 100%;
        }

        * {
            box-sizing: border-box;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100%;
            padding-bottom: 80px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            width: 60px;
            height: 60px;
            background: #1E3A8A;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 16px;
            border: 4px solid white;
            box-shadow: 0 4px 20px rgba(30, 58, 138, 0.4);
        }

        .header-title {
            font-size: 28px;
            font-weight: 600;
            color: #1E3A8A;
            margin: 0;
        }

        .screen {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #1E3A8A;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 500;
            color: #1E3A8A;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-input, .form-select, .form-textarea {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #1E3A8A;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #1E3A8A 0%, #6D28D9 100%);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #2563EB 0%, #7C3AED 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(30, 58, 138, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .image-upload-area {
            border: 2px dashed #ccc;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .image-upload-area:hover,
        .image-upload-area:focus {
            background: #f8f9fa;
            border-color: #1E3A8A;
        }

        .image-upload-area.active {
            background: #EEF2FF;
            border-color: #1E3A8A;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }

        .upload-icon {
            width: 48px;
            height: 48px;
            opacity: 0.6;
            margin-bottom: 8px;
        }

        .upload-text {
            color: #666;
            font-size: 16px;
            font-weight: 500;
            margin: 0;
        }

        .upload-subtext {
            color: #999;
            font-size: 14px;
            margin: 0;
        }

        .images-container {
            margin-top: 20px;
        }

        .images-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .image-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            background: white;
            border: 1px solid #e0e0e0;
        }

        .image-preview {
            width: 100%;
            max-height: 400px;
            object-fit: contain;
            display: block;
            background: #f8f9fa;
        }

        .image-remove {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.2s ease;
        }

        .image-remove:hover {
            background: #dc3545;
            transform: scale(1.1);
        }

        .no-images {
            display: block;
        }

        .has-images {
            display: none;
        }

        .section-items {
            margin-top: 20px;
        }

        .item-row {
            display: flex;
            gap: 12px;
            align-items: center;
            padding: 12px;
            background: rgba(30, 58, 138, 0.05);
            border-radius: 8px;
            margin-bottom: 10px;
            min-height: 60px;
        }

        .item-row .form-select {
            flex: 2;
            min-width: 200px;
        }

        .item-row .form-input {
            flex: 1;
            min-width: 80px;
        }

        .item-row .btn {
            flex-shrink: 0;
            width: 40px;
            height: 40px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .totals-section {
            background: linear-gradient(135deg, #1E3A8A, #6D28D9);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }

        .totals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .total-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .total-label {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .total-value {
            font-size: 18px;
            font-weight: 600;
        }

        .acrescimo-box {
            background: rgba(255, 193, 7, 0.2);
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            font-weight: 500;
        }

        .isento-box {
            background: rgba(40, 167, 69, 0.2);
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            font-weight: 500;
            color: #155724;
        }

        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            padding: 15px;
            text-align: center;
            color: white;
            font-size: 12px;
            font-weight: 300;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
        }

        .table-container {
            overflow-x: auto;
        }

        .values-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .values-table th,
        .values-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .values-table th {
            background: rgba(30, 58, 138, 0.1);
            font-weight: 600;
            color: #1E3A8A;
        }

        .values-table input {
            width: 100%;
            padding: 8px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .technology-buttons {
            display: flex;
            gap: 15px;
            margin-top: 8px;
        }

        .btn-technology {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 500;
        }

        .btn-technology:hover {
            border-color: #1E3A8A;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(30, 58, 138, 0.2);
        }

        .btn-technology.active {
            background: linear-gradient(135deg, #1E3A8A, #6D28D9);
            border-color: #1E3A8A;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(30, 58, 138, 0.3);
        }

        .btn-technology.active.offset {
            background: #dc3545;
            border-color: #dc3545;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .btn-technology.active.digital {
            background: #28a745;
            border-color: #28a745;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .tech-icon {
            font-size: 24px;
        }

        .tech-name {
            font-size: 14px;
            font-weight: 600;
        }

        /* Estilos para impress√£o */
        @media print {
            body {
                background: white !important;
                color: black !important;
                font-size: 12px;
                line-height: 1.4;
                margin: 0;
                padding: 0;
            }
            
            .container {
                max-width: none !important;
                padding: 10px !important;
                margin: 0 !important;
                background: white !important;
            }
            
            .header {
                background: white !important;
                border: 2px solid #1E3A8A !important;
                box-shadow: none !important;
                margin-bottom: 15px !important;
                page-break-inside: avoid;
            }
            
            .card {
                background: white !important;
                border: 1px solid #ddd !important;
                box-shadow: none !important;
                margin-bottom: 15px !important;
                page-break-inside: avoid;
            }
            
            .totals-section {
                background: #f8f9fa !important;
                color: black !important;
                border: 2px solid #1E3A8A !important;
                page-break-inside: avoid;
            }
            
            .total-item {
                background: white !important;
                border: 1px solid #ddd !important;
                color: black !important;
            }
            
            /* Esconder elementos desnecess√°rios na impress√£o */
            .btn, .nav-buttons, .footer, .image-remove {
                display: none !important;
            }
            
            /* Ajustar tabelas para impress√£o */
            .item-row {
                border: 1px solid #ddd !important;
                background: white !important;
                margin-bottom: 5px !important;
                padding: 8px !important;
            }
            
            .form-input, .form-select, .form-textarea {
                border: 1px solid #ccc !important;
                background: white !important;
                font-size: 11px !important;
                padding: 4px !important;
            }
            
            /* Garantir que imagens sejam impressas */
            .image-preview {
                max-height: 200px !important;
                page-break-inside: avoid;
            }
            
            .images-grid {
                display: block !important;
            }
            
            .image-item {
                margin-bottom: 10px !important;
                page-break-inside: avoid;
            }
            
            /* Ajustar grid para impress√£o */
            .form-grid {
                grid-template-columns: 1fr 1fr !important;
                gap: 10px !important;
            }
            
            .totals-grid {
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 10px !important;
            }
            
            /* Quebras de p√°gina estrat√©gicas */
            .card:nth-child(3) {
                page-break-before: auto;
            }
            
            .totals-section {
                page-break-before: auto;
            }
            
            /* T√≠tulos das se√ß√µes */
            .card-title {
                font-weight: bold !important;
                color: #1E3A8A !important;
                border-bottom: 1px solid #1E3A8A !important;
                padding-bottom: 5px !important;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header {
                flex-direction: column;
                text-align: center;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .technology-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn-technology {
                flex-direction: row;
                justify-content: center;
                padding: 12px 20px;
            }
            
            .tech-icon {
                font-size: 20px;
            }
            
            .tech-name {
                font-size: 14px;
            }
            
            .item-row {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
                min-height: auto;
            }
            
            .item-row .form-select,
            .item-row .form-input {
                min-width: auto;
                width: 100%;
            }
            
            .item-row .btn {
                width: 100%;
                height: 45px;
            }
            
            .totals-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-buttons {
                flex-direction: column;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container"><!-- Header -->
   <div class="header">
    <div class="logo" id="company-logo">
     DIGRA
    </div>
    <h1 class="header-title" id="app-title">Or√ßamento Gr√°fico</h1>
   </div><!-- Tela 1: Or√ßamento -->
   <div id="screen-budget" class="screen active"><!-- Informa√ß√µes Iniciais -->
    <div class="card">
     <h2 class="card-title">üìã Informa√ß√µes Iniciais</h2>
     <div class="form-grid">
      <div class="form-group"><label class="form-label">Quantidade Total de Itens *</label> <input type="number" id="total-quantity" class="form-input" placeholder="Ex: 1000" min="1" required>
      </div>
      <div class="form-group"><label class="form-label">Tamanho Final do Produto *</label> <input type="text" id="product-size" class="form-input" placeholder="Ex: 10x15cm" required>
      </div>
      <div class="form-group"><label class="form-label">Tecnologia de Impress√£o *</label>
       <div class="technology-buttons"><button type="button" class="btn-technology" id="btn-offset" onclick="selectTechnology('OFFSET')"> <span class="tech-icon">‚öôÔ∏è</span> <span class="tech-name">OFFSET</span> </button> <button type="button" class="btn-technology" id="btn-digital" onclick="selectTechnology('DIGITAL')"> <span class="tech-icon">üñ®Ô∏è</span> <span class="tech-name">DIGITAL</span> </button>
       </div><input type="hidden" id="print-technology" required>
      </div>
     </div>
     <div id="acrescimo-info" style="display: none;"></div>
     <div class="form-grid">
      <div class="form-group"><label class="form-label">Descri√ß√£o do Servi√ßo</label> <textarea id="service-description" class="form-textarea" placeholder="Descreva o servi√ßo a ser realizado..."></textarea>
      </div>
      <div class="form-group"><label class="form-label">Dados T√©cnicos</label> <textarea id="technical-data" class="form-textarea" placeholder="Informa√ß√µes t√©cnicas do projeto..."></textarea>
      </div>
     </div>
    </div><!-- √Årea de Imagem -->
    <div class="card">
     <h2 class="card-title">üñºÔ∏è Imagens do Projeto</h2>
     <div class="image-upload-area" id="image-upload" tabindex="0">
      <svg class="upload-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2" /> <circle cx="8.5" cy="8.5" r="1.5" /> <polyline points="21,15 16,10 5,21" />
      </svg>
      <p class="upload-text">Clique aqui e cole suas imagens (Ctrl+V)</p>
      <p class="upload-subtext">Voc√™ pode colar m√∫ltiplas imagens</p>
     </div>
     <div id="image-container" class="images-container">
      <div class="images-grid"></div>
     </div>
    </div><!-- Pap√©is Utilizados -->
    <div class="card">
     <h2 class="card-title" id="paper-section-title">üìÑ Pap√©is Utilizados</h2><button class="btn btn-primary" onclick="addPaperItem()">+ Adicionar Papel</button>
     <div id="papers-section" class="section-items"></div>
    </div><!-- Materiais Utilizados -->
    <div class="card">
     <h2 class="card-title">üõ†Ô∏è Materiais Utilizados</h2><button class="btn btn-primary" onclick="addMaterialItem()">+ Adicionar Material</button>
     <div id="materials-section" class="section-items"></div>
    </div><!-- Impress√£o Digital -->
    <div class="card">
     <h2 class="card-title">üñ®Ô∏è Impress√£o Digital</h2><button class="btn btn-primary" onclick="addPrintItem()">+ Adicionar Impress√£o</button>
     <div id="printing-section" class="section-items"></div>
    </div><!-- M√£o de Obra -->
    <div class="card">
     <h2 class="card-title">üë• M√£o de Obra</h2><button class="btn btn-primary" onclick="addLaborItem()">+ Adicionar Profissional</button>
     <div id="labor-section" class="section-items"></div>
    </div><!-- Totais -->
    <div class="totals-section">
     <h2 style="text-align: center; margin-bottom: 25px;">üí∞ Resumo Financeiro</h2>
     <div class="totals-grid">
      <div class="total-item">
       <div class="total-label">
        Pap√©is
       </div>
       <div class="total-value" id="total-papers">
        R$ 0,00
       </div>
      </div>
      <div class="total-item">
       <div class="total-label">
        Materiais
       </div>
       <div class="total-value" id="total-materials">
        R$ 0,00
       </div>
      </div>
      <div class="total-item">
       <div class="total-label">
        Impress√£o
       </div>
       <div class="total-value" id="total-printing">
        R$ 0,00
       </div>
      </div>
      <div class="total-item">
       <div class="total-label">
        M√£o de Obra
       </div>
       <div class="total-value" id="total-labor">
        R$ 0,00
       </div>
      </div>
      <div class="total-item">
       <div class="total-label">
        Acr√©scimo 10%
       </div>
       <div class="total-value" id="total-acrescimo">
        R$ 0,00
       </div>
      </div>
      <div class="total-item" style="background: rgba(255, 255, 255, 0.2);">
       <div class="total-label">
        TOTAL GERAL
       </div>
       <div class="total-value" id="total-general">
        R$ 0,00
       </div>
      </div>
     </div>
     <div style="text-align: center; margin-top: 25px; padding: 20px; background: rgba(255, 255, 255, 0.1); border-radius: 8px;">
      <div class="total-label">
       Valor Unit√°rio Final
      </div>
      <div class="total-value" style="font-size: 24px;" id="unit-price">
       R$ 0,00
      </div>
     </div>
    </div><!-- Bot√µes de A√ß√£o -->
    <div class="nav-buttons"><button class="btn btn-primary" onclick="printBudget()">üñ®Ô∏è Imprimir / Salvar em PDF</button> <button class="btn btn-secondary" onclick="showValuesScreen()">‚öôÔ∏è Editar Valores Base</button>
    </div>
   </div><!-- Tela 2: Valores Base -->
   <div id="screen-values" class="screen">
    <div class="card">
     <h2 class="card-title">‚öôÔ∏è Valores Base e Configura√ß√µes</h2>
     <h3 style="color: #2c5f5f; margin-top: 30px;">üìÑ Pap√©is</h3>
     <div class="table-container">
      <table class="values-table">
       <thead>
        <tr>
         <th>Nome do Papel</th>
         <th>Valor por Folha (R$)</th>
         <th>A√ß√µes</th>
        </tr>
       </thead>
       <tbody id="papers-values-table"></tbody>
      </table>
     </div><button class="btn btn-primary" onclick="addNewPaperValue()">+ Adicionar Papel</button>
     <h3 style="color: #2c5f5f; margin-top: 30px;">üõ†Ô∏è Materiais</h3>
     <div class="table-container">
      <table class="values-table">
       <thead>
        <tr>
         <th>Nome do Material</th>
         <th>Valor Unit√°rio (R$)</th>
         <th>A√ß√µes</th>
        </tr>
       </thead>
       <tbody id="materials-values-table"></tbody>
      </table>
     </div><button class="btn btn-primary" onclick="addNewMaterialValue()">+ Adicionar Material</button>
     <h3 style="color: #2c5f5f; margin-top: 30px;">üñ®Ô∏è Impress√£o Digital</h3>
     <div class="table-container">
      <table class="values-table">
       <thead>
        <tr>
         <th>Tipo de Impress√£o</th>
         <th>Valor Unit√°rio (R$)</th>
         <th>A√ß√µes</th>
        </tr>
       </thead>
       <tbody id="printing-values-table"></tbody>
      </table>
     </div><button class="btn btn-primary" onclick="addNewPrintingValue()">+ Adicionar Impress√£o</button>
     <h3 style="color: #2c5f5f; margin-top: 30px;">üë• M√£o de Obra</h3>
     <div class="table-container">
      <table class="values-table">
       <thead>
        <tr>
         <th>Profissional</th>
         <th>Valor por Hora (R$)</th>
         <th>A√ß√µes</th>
        </tr>
       </thead>
       <tbody id="labor-values-table"></tbody>
      </table>
     </div><button class="btn btn-primary" onclick="addNewLaborValue()">+ Adicionar Profissional</button>
     <div class="nav-buttons"><button class="btn btn-success" onclick="saveAllValues()">üíæ Salvar Altera√ß√µes</button> <button class="btn btn-secondary" onclick="showBudgetScreen()">‚Üê Voltar ao Or√ßamento</button>
     </div>
    </div>
   </div>
  </div><!-- Footer -->
  <div class="footer"><span id="footer-text">‚ö° Alexandre | DIGRA Apps</span>
  </div>
  <script>
        // Configura√ß√£o padr√£o
        const defaultConfig = {
            company_name: "DIGRA",
            app_title: "Or√ßamento Gr√°fico",
            footer_text: "‚ö° Alexandre | DIGRA Apps"
        };

        // Estado da aplica√ß√£o
        let appState = {
            papers: [],
            materials: [],
            printing: [],
            labor: [],
            totals: {
                papers: 0,
                materials: 0,
                printing: 0,
                labor: 0,
                acrescimo: 0,
                general: 0
            }
        };

        // Valores base da planilha
        const defaultValues = {
            papersOffset: [
                { name: "Adesivo Fosco - 180g", prices: { A4: 0.33, A3: 0.74, Folha: 2.97, Pacote: 296.64 } },
                { name: "Cart√£o Triplex - 250g", prices: { A4: 0.35, A3: 0.79, Folha: 3.17, Pacote: 475.00 } },
                { name: "Cartolina Branca - 180g", prices: { A4: 0.29, A3: 0.57, Folha: 1.14, Pacote: 114.00 } },
                { name: "Cartolina Branca - 240g", prices: { A4: 0.24, A3: 0.48, Folha: 0.95, Pacote: 95.00 } },
                { name: "Couch√™ 115g", prices: { A4: 0.09, A3: 0.19, Folha: 0.77, Pacote: 192.00 } },
                { name: "Couch√™ 150g", prices: { A4: 0.08, A3: 0.17, Folha: 0.68, Pacote: 169.45 } },
                { name: "Couch√™ 210g", prices: { A4: 0.19, A3: 0.43, Folha: 1.71, Pacote: 256.69 } },
                { name: "Kraft 110g", prices: { A4: 0.11, A3: 0.24, Folha: 0.97, Pacote: 241.84 } },
                { name: "Opaline 180g", prices: { A4: 0.18, A3: 0.42, Folha: 1.68, Pacote: 114.00 } },
                { name: "Offset 75g", prices: { A4: 0.06, A3: 0.13, Folha: 0.53, Pacote: 132.00 } },
                { name: "Offset 90g", prices: { A4: 0.05, A3: 0.12, Folha: 0.47, Pacote: 236.71 } },
                { name: "Offset 120g", prices: { A4: 0.09, A3: 0.20, Folha: 0.80, Pacote: 200.01 } },
                { name: "Verg√™ 80g", prices: { A4: 0.04, A3: 0.10, Folha: 0.39, Pacote: 98.64 } },
                { name: "Verg√™ 180g", prices: { A4: 0.12, A3: 0.28, Folha: 1.12, Pacote: 139.49 } }
            ],
            papersDigital: [
                { name: "A4 (210x297mm)", price: 0.15 },
                { name: "A3 (297x420mm)", price: 0.30 },
                { name: "Of√≠cio II (216x330mm)", price: 0.18 }
            ],
            materials: {
                "Chapa Offset Positiva": {
                    types: {
                        "Sakurai": { price: 7.58, hasSizes: false },
                        "Heidelberg": { price: 14.00, hasSizes: false }
                    }
                },
                "Chapa Offset T√©rmica Digital (CTP)": {
                    types: {
                        "Sakurai": { price: 57.00, hasSizes: false },
                        "Heidelberg": { price: 54.50, hasSizes: false }
                    }
                },
                "Espiral": {
                    types: {
                        "7mm": { price: 0.12, hasSizes: false },
                        "9mm": { price: 0.15, hasSizes: false },
                        "12mm": { price: 0.18, hasSizes: false },
                        "14mm": { price: 0.22, hasSizes: false },
                        "17mm": { price: 0.28, hasSizes: false },
                        "20mm": { price: 0.35, hasSizes: false },
                        "23mm": { price: 0.42, hasSizes: false },
                        "25mm": { price: 0.48, hasSizes: false },
                        "29mm": { price: 0.58, hasSizes: false },
                        "33mm": { price: 0.68, hasSizes: false },
                        "40mm": { price: 0.85, hasSizes: false },
                        "45mm": { price: 1.02, hasSizes: false },
                        "50mm": { price: 1.18, hasSizes: false }
                    }
                },
                "Capa para Encaderna√ß√£o PP (Polietileno)": {
                    types: {
                        "Transparente": { price: 0.40, hasSizes: false },
                        "Preta": { price: 0.30, hasSizes: false }
                    }
                },
                "Fita Dupla Face": {
                    types: {
                        "19mm (por cm)": { price: 0.08, hasSizes: false },
                        "25mm (por cm)": { price: 0.12, hasSizes: false },
                        "50mm (por cm)": { price: 0.24, hasSizes: false }
                    }
                },
                "Bobina Polietileno (Plastifica√ß√£o)": {
                    types: {
                        "Por cm": { price: 0.0342, hasSizes: false }
                    }
                },
                "Adesivo Vinil": {
                    types: {
                        "Preto": { price: 14.40, hasSizes: false },
                        "Azul M√©dio": { price: 15.86, hasSizes: false },
                        "Vermelho M√©dio": { price: 18.31, hasSizes: false },
                        "Transparente": { price: 9.90, hasSizes: false },
                        "M√°scara": { price: 17.11, hasSizes: false }
                    }
                },
                "Bolsa para Pastas": {
                    types: {
                        "Padr√£o": { price: 0.27, hasSizes: false }
                    }
                }
            },
            printing: [
                { name: "Preto frente (1/0)", price: 0.03 },
                { name: "Preto frente e verso (1/1)", price: 0.06 },
                { name: "Colorido frente (4/0)", price: 0.25 },
                { name: "Colorido frente e verso (4/4)", price: 0.50 }
            ],
            labor: [
                { name: "Coordenador de Artes Gr√°ficas", hourPrice: 85.67, minutePrice: 1.43 },
                { name: "Designer Gr√°fico", hourPrice: 65.00, minutePrice: 1.08 },
                { name: "Or√ßamentista Gr√°fico", hourPrice: 41.37, minutePrice: 0.69 },
                { name: "Mestre Impressor", hourPrice: 53.84, minutePrice: 0.90 },
                { name: "Impressor Digital", hourPrice: 36.00, minutePrice: 0.60 },
                { name: "Mestre Impressor Offset", hourPrice: 53.84, minutePrice: 0.90 },
                { name: "Impressor Offset", hourPrice: 36.00, minutePrice: 0.60 },
                { name: "Operador de Guilhotina", hourPrice: 36.00, minutePrice: 0.60 },
                { name: "Mestre de Servi√ßos Gr√°ficos", hourPrice: 53.84, minutePrice: 0.90 },
                { name: "Operador de Acabamento Gr√°fico", hourPrice: 36.00, minutePrice: 0.60 },
                { name: "Encarregado", hourPrice: 53.84, minutePrice: 0.90 }
            ]
        };

        // Handler para o Data SDK
        const dataHandler = {
            onDataChanged(data) {
                // Atualiza os valores base com os dados salvos
                updateValuesFromData(data);
                renderValuesTable();
            }
        };

        // Inicializa√ß√£o
        async function init() {
            // Inicializar Data SDK
            const initResult = await window.dataSdk.init(dataHandler);
            if (!initResult.isOk) {
                console.error("Erro ao inicializar Data SDK");
            }

            // Inicializar Element SDK
            if (window.elementSdk) {
                await window.elementSdk.init({
                    defaultConfig,
                    onConfigChange: async (config) => {
                        document.getElementById('company-logo').textContent = config.company_name || defaultConfig.company_name;
                        document.getElementById('app-title').textContent = config.app_title || defaultConfig.app_title;
                        document.getElementById('footer-text').textContent = config.footer_text || defaultConfig.footer_text;
                    },
                    mapToCapabilities: (config) => ({
                        recolorables: [],
                        borderables: [],
                        fontEditable: undefined,
                        fontSizeable: undefined
                    }),
                    mapToEditPanelValues: (config) => new Map([
                        ["company_name", config.company_name || defaultConfig.company_name],
                        ["app_title", config.app_title || defaultConfig.app_title],
                        ["footer_text", config.footer_text || defaultConfig.footer_text]
                    ])
                });
            }

            setupEventListeners();
            renderValuesTable();
        }

        function setupEventListeners() {
            // √Årea de imagem - configura√ß√£o completa
            const imageUpload = document.getElementById('image-upload');
            let isImageAreaActive = false;
            
            // Clique na √°rea para ativar
            imageUpload.addEventListener('click', () => {
                isImageAreaActive = true;
                imageUpload.classList.add('active');
                imageUpload.focus();
                
                // Mostrar feedback visual
                imageUpload.style.background = '#EEF2FF';
                imageUpload.style.borderColor = '#1E3A8A';
                
                // Atualizar texto
                const uploadText = imageUpload.querySelector('.upload-text');
                const uploadSubtext = imageUpload.querySelector('.upload-subtext');
                uploadText.textContent = '‚úÖ √Årea ativa! Use Ctrl+V para colar';
                uploadSubtext.textContent = 'Clique fora para desativar';
            });
            
            // Desativar quando clica fora
            document.addEventListener('click', (e) => {
                if (!imageUpload.contains(e.target) && isImageAreaActive) {
                    isImageAreaActive = false;
                    imageUpload.classList.remove('active');
                    
                    // Restaurar visual
                    imageUpload.style.background = '';
                    imageUpload.style.borderColor = '';
                    
                    // Restaurar texto
                    const uploadText = imageUpload.querySelector('.upload-text');
                    const uploadSubtext = imageUpload.querySelector('.upload-subtext');
                    uploadText.textContent = 'Clique aqui e cole suas imagens (Ctrl+V)';
                    uploadSubtext.textContent = 'Voc√™ pode colar m√∫ltiplas imagens';
                }
            });
            
            // Suporte a teclado
            imageUpload.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    isImageAreaActive = true;
                    imageUpload.classList.add('active');
                    imageUpload.style.background = '#f0f8ff';
                    imageUpload.style.borderColor = '#2c5f5f';
                }
            });
            
            // Paste de imagem - funciona globalmente mas s√≥ processa se √°rea ativa
            document.addEventListener('paste', (event) => {
                if (!isImageAreaActive) return;
                
                const items = event.clipboardData?.items;
                if (!items) return;
                
                let hasImage = false;
                for (let item of items) {
                    if (item.type.startsWith('image/')) {
                        event.preventDefault();
                        hasImage = true;
                        const file = item.getAsFile();
                        displayImage(file);
                    }
                }
                
                // Feedback visual quando cola imagem
                if (hasImage) {
                    imageUpload.style.background = '#e8f5e8';
                    imageUpload.style.borderColor = '#28a745';
                    
                    const uploadText = imageUpload.querySelector('.upload-text');
                    uploadText.textContent = '‚úÖ Imagem colada com sucesso!';
                    
                    setTimeout(() => {
                        if (isImageAreaActive) {
                            imageUpload.style.background = '#f0f8ff';
                            imageUpload.style.borderColor = '#2c5f5f';
                            uploadText.textContent = '‚úÖ √Årea ativa! Use Ctrl+V para colar';
                        }
                    }, 1000);
                }
            });
            
            // Auto-c√°lculo
            document.addEventListener('input', (e) => {
                if (e.target.classList.contains('quantity-input') || e.target.classList.contains('price-input')) {
                    updateCalculations();
                }
            });
        }

        function selectTechnology(tech) {
            // Atualizar campo hidden
            document.getElementById('print-technology').value = tech;
            
            // Atualizar visual dos bot√µes
            document.querySelectorAll('.btn-technology').forEach(btn => {
                btn.classList.remove('active', 'offset', 'digital');
            });
            
            const selectedBtn = document.getElementById(`btn-${tech.toLowerCase()}`);
            selectedBtn.classList.add('active', tech.toLowerCase());
            
            // Atualizar t√≠tulo da se√ß√£o de pap√©is
            const paperTitle = document.getElementById('paper-section-title');
            if (tech === 'OFFSET') {
                paperTitle.textContent = 'üìÑ Papel para M√°quina OFFSET';
            } else if (tech === 'DIGITAL') {
                paperTitle.textContent = 'üìÑ Papel para Impress√£o Digital';
            } else {
                paperTitle.textContent = 'üìÑ Pap√©is Utilizados';
            }
            
            // Atualizar informa√ß√µes de acr√©scimo
            updateAcrescimoInfo();
            
            // Atualizar op√ß√µes de papel baseado na tecnologia
            updatePaperOptions();
        }

        function updateAcrescimoInfo() {
            const technology = document.getElementById('print-technology').value;
            const acrescimoDiv = document.getElementById('acrescimo-info');
            
            if (technology === 'OFFSET') {
                acrescimoDiv.innerHTML = '<div class="acrescimo-box">‚ö†Ô∏è Acr√©scimo de 10% sobre Papel + Materiais ser√° aplicado</div>';
                acrescimoDiv.style.display = 'block';
            } else if (technology === 'DIGITAL') {
                acrescimoDiv.innerHTML = '<div class="isento-box">‚úÖ ISENTO de acr√©scimo</div>';
                acrescimoDiv.style.display = 'block';
            } else {
                acrescimoDiv.style.display = 'none';
            }
            
            updateCalculations();
        }

        function updatePaperOptions() {
            const technology = document.getElementById('print-technology').value;
            
            // Limpar se√ß√£o de pap√©is e recriar
            const papersSection = document.getElementById('papers-section');
            papersSection.innerHTML = '';
            
            updateCalculations();
        }

        // Array para armazenar as imagens
        let projectImages = [];





        function displayImage(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const imageId = 'img_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                projectImages.push({
                    id: imageId,
                    src: e.target.result,
                    name: file.name || 'Imagem colada'
                });
                renderImages();
            };
            reader.readAsDataURL(file);
        }

        function renderImages() {
            const container = document.querySelector('#image-container .images-grid');
            
            if (projectImages.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = projectImages.map(img => `
                <div class="image-item">
                    <img src="${img.src}" class="image-preview" alt="${img.name}" loading="lazy">
                    <button class="image-remove" onclick="removeImage('${img.id}')" title="Remover imagem">√ó</button>
                </div>
            `).join('');
        }

        function removeImage(imageId) {
            projectImages = projectImages.filter(img => img.id !== imageId);
            renderImages();
            
            // Feedback visual
            const imageUpload = document.getElementById('image-upload');
            imageUpload.style.background = '#ffe8e8';
            imageUpload.style.borderColor = '#dc3545';
            setTimeout(() => {
                imageUpload.style.background = '';
                imageUpload.style.borderColor = '';
            }, 300);
        }

        function addPaperItem() {
            const section = document.getElementById('papers-section');
            const id = 'paper_' + Date.now();
            const technology = document.getElementById('print-technology').value;
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item-row';
            
            if (technology === 'OFFSET') {
                // Para OFFSET: Tipo de papel + Tamanho + Quantidade + Valor + Total
                const paperOptions = defaultValues.papersOffset.map(p => 
                    `<option value="${p.name}">${p.name}</option>`
                ).join('');
                
                itemDiv.innerHTML = `
                    <select class="form-select paper-type-select" onchange="updatePaperOffsetPrice('${id}')" style="flex: 2;">
                        <option value="">Selecione o tipo...</option>
                        ${paperOptions}
                    </select>
                    <select class="form-select paper-size-select" onchange="updatePaperOffsetPrice('${id}')" style="flex: 1;">
                        <option value="">Tamanho...</option>
                        <option value="A4">A4</option>
                        <option value="A3">A3</option>
                        <option value="Folha">Folha</option>
                        <option value="Pacote">Pacote 66x96cm</option>
                    </select>
                    <input type="number" class="form-input quantity-input" placeholder="Qtd" min="0" step="0.01" style="flex: 1;">
                    <input type="number" class="form-input price-input" id="${id}" placeholder="Valor unit." step="0.01" readonly style="flex: 1;">
                    <input type="number" class="form-input total-input" placeholder="Total" readonly style="flex: 1;">
                    <button class="btn btn-danger" onclick="removeItem(this)">üóëÔ∏è</button>
                `;
            } else if (technology === 'DIGITAL') {
                // Para DIGITAL: mant√©m o formato antigo
                const paperOptions = defaultValues.papersDigital.map(p => 
                    `<option value="${p.name}" data-price="${p.price}">${p.name} - R$ ${p.price.toFixed(2)}</option>`
                ).join('');
                
                itemDiv.innerHTML = `
                    <select class="form-select paper-select" onchange="updatePaperPrice(this, '${id}')">
                        <option value="">Selecione o papel...</option>
                        ${paperOptions}
                    </select>
                    <input type="number" class="form-input quantity-input" placeholder="Quantidade" min="0" step="0.01">
                    <input type="number" class="form-input price-input" id="${id}" placeholder="Valor unit√°rio" step="0.01" readonly>
                    <input type="number" class="form-input total-input" placeholder="Total" readonly>
                    <button class="btn btn-danger" onclick="removeItem(this)">üóëÔ∏è</button>
                `;
            } else {
                // Se n√£o selecionou tecnologia
                itemDiv.innerHTML = `
                    <div style="padding: 15px; background: #fff3cd; border-radius: 8px; text-align: center; color: #856404;">
                        ‚ö†Ô∏è Selecione a tecnologia de impress√£o primeiro
                    </div>
                `;
            }
            
            section.appendChild(itemDiv);
        }

        function addMaterialItem() {
            const section = document.getElementById('materials-section');
            const id = 'material_' + Date.now();
            
            // Criar op√ß√µes de categoria de material
            const materialCategories = Object.keys(defaultValues.materials).map(cat => 
                `<option value="${cat}">${cat}</option>`
            ).join('');
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item-row';
            itemDiv.innerHTML = `
                <select class="form-select material-category-select" onchange="updateMaterialTypes('${id}')" style="flex: 2;">
                    <option value="">Selecione o material...</option>
                    ${materialCategories}
                </select>
                <select class="form-select material-type-select" onchange="updateMaterialPriceNew('${id}')" style="flex: 2;" disabled>
                    <option value="">Selecione o tipo...</option>
                </select>
                <input type="number" class="form-input quantity-input" placeholder="Qtd" min="0" step="0.01" style="flex: 1;">
                <input type="number" class="form-input price-input" id="${id}" placeholder="Valor unit." step="0.01" readonly style="flex: 1;">
                <input type="number" class="form-input total-input" placeholder="Total" readonly style="flex: 1;">
                <button class="btn btn-danger" onclick="removeItem(this)">üóëÔ∏è</button>
            `;
            
            section.appendChild(itemDiv);
        }
        
        function updateMaterialTypes(inputId) {
            const row = document.getElementById(inputId).closest('.item-row');
            const categorySelect = row.querySelector('.material-category-select');
            const typeSelect = row.querySelector('.material-type-select');
            const priceInput = document.getElementById(inputId);
            
            const category = categorySelect.value;
            
            if (!category) {
                typeSelect.disabled = true;
                typeSelect.innerHTML = '<option value="">Selecione o tipo...</option>';
                priceInput.value = '';
                updateCalculations();
                return;
            }
            
            // Preencher tipos baseado na categoria
            const types = defaultValues.materials[category].types;
            const typeOptions = Object.keys(types).map(typeName => {
                const typeData = types[typeName];
                return `<option value="${typeName}" data-price="${typeData.price}">${typeName} - R$ ${typeData.price.toFixed(2)}</option>`;
            }).join('');
            
            typeSelect.innerHTML = '<option value="">Selecione o tipo...</option>' + typeOptions;
            typeSelect.disabled = false;
            priceInput.value = '';
            updateCalculations();
        }
        
        function updateMaterialPriceNew(inputId) {
            const row = document.getElementById(inputId).closest('.item-row');
            const categorySelect = row.querySelector('.material-category-select');
            const typeSelect = row.querySelector('.material-type-select');
            const priceInput = document.getElementById(inputId);
            
            const category = categorySelect.value;
            const type = typeSelect.value;
            
            if (category && type) {
                const price = defaultValues.materials[category].types[type].price;
                priceInput.value = price.toFixed(2);
                updateCalculations();
            } else {
                priceInput.value = '';
                updateCalculations();
            }
        }

        function addPrintItem() {
            const section = document.getElementById('printing-section');
            const id = 'print_' + Date.now();
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item-row';
            itemDiv.innerHTML = `
                <select class="form-select print-select" onchange="updatePrintPrice(this, '${id}')">
                    <option value="">Selecione o tipo de impress√£o...</option>
                    ${defaultValues.printing.map(p => `<option value="${p.name}" data-price="${p.price}">${p.name} - R$ ${p.price.toFixed(2)}</option>`).join('')}
                </select>
                <input type="number" class="form-input quantity-input" placeholder="Quantidade" min="0" step="0.01">
                <input type="number" class="form-input price-input" id="${id}" placeholder="Valor unit√°rio" step="0.01" readonly>
                <input type="number" class="form-input total-input" placeholder="Total" readonly>
                <button class="btn btn-danger" onclick="removeItem(this)">üóëÔ∏è</button>
            `;
            
            section.appendChild(itemDiv);
        }

        function addLaborItem() {
            const section = document.getElementById('labor-section');
            const id = 'labor_' + Date.now();
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item-row';
            itemDiv.innerHTML = `
                <select class="form-select labor-select" onchange="updateLaborPrice(this, '${id}')">
                    <option value="">Selecione o profissional...</option>
                    ${defaultValues.labor.map(l => `<option value="${l.name}" data-hour-price="${l.hourPrice}" data-minute-price="${l.minutePrice}">${l.name} - R$ ${l.hourPrice.toFixed(2)}/h</option>`).join('')}
                </select>
                <input type="number" class="form-input quantity-input" placeholder="Tempo (minutos)" min="0" step="1">
                <input type="number" class="form-input price-input" id="${id}" placeholder="Valor/min" step="0.01" readonly>
                <input type="number" class="form-input total-input" placeholder="Total" readonly>
                <button class="btn btn-danger" onclick="removeItem(this)">üóëÔ∏è</button>
            `;
            
            section.appendChild(itemDiv);
        }

        function updatePaperOffsetPrice(inputId) {
            const row = document.getElementById(inputId).closest('.item-row');
            const typeSelect = row.querySelector('.paper-type-select');
            const sizeSelect = row.querySelector('.paper-size-select');
            const priceInput = document.getElementById(inputId);
            
            const paperType = typeSelect.value;
            const paperSize = sizeSelect.value;
            
            if (paperType && paperSize) {
                const paper = defaultValues.papersOffset.find(p => p.name === paperType);
                if (paper && paper.prices[paperSize]) {
                    priceInput.value = paper.prices[paperSize].toFixed(2);
                    updateCalculations();
                }
            } else {
                priceInput.value = '';
                updateCalculations();
            }
        }

        function updatePaperPrice(select, inputId) {
            const selectedOption = select.options[select.selectedIndex];
            const price = selectedOption.dataset.price || 0;
            document.getElementById(inputId).value = price;
            updateCalculations();
        }



        function updatePrintPrice(select, inputId) {
            const selectedOption = select.options[select.selectedIndex];
            const price = selectedOption.dataset.price || 0;
            document.getElementById(inputId).value = price;
            updateCalculations();
        }

        function updateLaborPrice(select, inputId) {
            const selectedOption = select.options[select.selectedIndex];
            const minutePrice = selectedOption.dataset.minutePrice || 0;
            document.getElementById(inputId).value = minutePrice;
            updateCalculations();
        }

        function removeItem(button) {
            button.parentElement.remove();
            updateCalculations();
        }

        function updateCalculations() {
            // Calcular totais por se√ß√£o
            const paperTotal = calculateSectionTotal('papers-section');
            const materialTotal = calculateSectionTotal('materials-section');
            const printingTotal = calculateSectionTotal('printing-section');
            const laborTotal = calculateSectionTotal('labor-section');
            
            // Calcular acr√©scimo de 10% se OFFSET
            const technology = document.getElementById('print-technology').value;
            const acrescimo = technology === 'OFFSET' ? (paperTotal + materialTotal) * 0.1 : 0;
            
            // Total geral
            const totalGeneral = paperTotal + materialTotal + printingTotal + laborTotal + acrescimo;
            
            // Valor unit√°rio
            const totalQuantity = parseFloat(document.getElementById('total-quantity').value) || 1;
            const unitPrice = totalGeneral / totalQuantity;
            
            // Atualizar display
            document.getElementById('total-papers').textContent = formatCurrency(paperTotal);
            document.getElementById('total-materials').textContent = formatCurrency(materialTotal);
            document.getElementById('total-printing').textContent = formatCurrency(printingTotal);
            document.getElementById('total-labor').textContent = formatCurrency(laborTotal);
            document.getElementById('total-acrescimo').textContent = formatCurrency(acrescimo);
            document.getElementById('total-general').textContent = formatCurrency(totalGeneral);
            document.getElementById('unit-price').textContent = formatCurrency(unitPrice);
            
            // Atualizar totais individuais nas linhas
            updateRowTotals();
        }

        function calculateSectionTotal(sectionId) {
            const section = document.getElementById(sectionId);
            const rows = section.querySelectorAll('.item-row');
            let total = 0;
            
            rows.forEach(row => {
                const quantity = parseFloat(row.querySelector('.quantity-input').value) || 0;
                const price = parseFloat(row.querySelector('.price-input').value) || 0;
                total += quantity * price;
            });
            
            return total;
        }

        function updateRowTotals() {
            const allRows = document.querySelectorAll('.item-row');
            
            allRows.forEach(row => {
                const quantity = parseFloat(row.querySelector('.quantity-input').value) || 0;
                const price = parseFloat(row.querySelector('.price-input').value) || 0;
                const total = quantity * price;
                row.querySelector('.total-input').value = total.toFixed(2);
            });
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        function printBudget() {
            // Remover alertas anteriores
            const existingAlert = document.querySelector('.print-alert');
            if (existingAlert) existingAlert.remove();
            
            // Verificar campos obrigat√≥rios
            const totalQuantity = document.getElementById('total-quantity').value.trim();
            const productSize = document.getElementById('product-size').value.trim();
            const technology = document.getElementById('print-technology').value;
            
            // Lista de campos faltando
            const missingFields = [];
            if (!totalQuantity) missingFields.push('Quantidade');
            if (!productSize) missingFields.push('Tamanho');
            if (!technology) missingFields.push('Tecnologia');
            
            if (missingFields.length > 0) {
                // Criar mensagem de aviso
                const alertDiv = document.createElement('div');
                alertDiv.className = 'print-alert';
                alertDiv.style.cssText = `
                    background: #fff3cd;
                    border: 2px solid #ffc107;
                    color: #856404;
                    padding: 20px;
                    border-radius: 12px;
                    margin: 20px 0;
                    text-align: center;
                    font-weight: 600;
                    font-size: 16px;
                    box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
                `;
                alertDiv.innerHTML = `
                    <div style="font-size: 24px; margin-bottom: 10px;">‚ö†Ô∏è</div>
                    <div>Campos obrigat√≥rios n√£o preenchidos:</div>
                    <div style="color: #dc3545; font-weight: bold; margin: 10px 0;">${missingFields.join(', ')}</div>
                    <div style="font-size: 14px; margin-top: 15px;">Complete as informa√ß√µes para imprimir o or√ßamento</div>
                `;
                
                const navButtons = document.querySelector('.nav-buttons');
                navButtons.parentNode.insertBefore(alertDiv, navButtons);
                
                // Destacar campos faltando
                if (!totalQuantity) document.getElementById('total-quantity').style.borderColor = '#dc3545';
                if (!productSize) document.getElementById('product-size').style.borderColor = '#dc3545';
                if (!technology) {
                    document.querySelectorAll('.btn-technology').forEach(btn => {
                        btn.style.borderColor = '#dc3545';
                        btn.style.boxShadow = '0 0 0 2px rgba(220, 53, 69, 0.2)';
                    });
                }
                
                // Remover destaque ap√≥s 3 segundos
                setTimeout(() => {
                    document.getElementById('total-quantity').style.borderColor = '';
                    document.getElementById('product-size').style.borderColor = '';
                    document.querySelectorAll('.btn-technology').forEach(btn => {
                        btn.style.borderColor = '';
                        btn.style.boxShadow = '';
                    });
                }, 3000);
                
                // Remover alerta ap√≥s 8 segundos
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.remove();
                    }
                }, 8000);
                
                return;
            }
            
            // Tudo OK - proceder com impress√£o
            try {
                // Mostrar feedback de sucesso
                const successDiv = document.createElement('div');
                successDiv.className = 'print-alert';
                successDiv.style.cssText = `
                    background: #d4edda;
                    border: 2px solid #28a745;
                    color: #155724;
                    padding: 15px;
                    border-radius: 8px;
                    margin: 15px 0;
                    text-align: center;
                    font-weight: 500;
                `;
                successDiv.innerHTML = 'üñ®Ô∏è Abrindo janela de impress√£o...';
                
                const navButtons = document.querySelector('.nav-buttons');
                navButtons.parentNode.insertBefore(successDiv, navButtons);
                
                // Aguardar um pouco e abrir impress√£o
                setTimeout(() => {
                    window.print();
                    
                    // Atualizar mensagem
                    successDiv.innerHTML = '‚úÖ Janela de impress√£o aberta! Escolha sua impressora ou "Salvar como PDF"';
                    
                    // Remover ap√≥s 5 segundos
                    setTimeout(() => {
                        if (successDiv.parentNode) {
                            successDiv.remove();
                        }
                    }, 5000);
                }, 500);
                
            } catch (error) {
                // Fallback se window.print() falhar
                const fallbackDiv = document.createElement('div');
                fallbackDiv.className = 'print-alert';
                fallbackDiv.style.cssText = `
                    background: #fff3cd;
                    border: 2px solid #ffc107;
                    color: #856404;
                    padding: 15px;
                    border-radius: 8px;
                    margin: 15px 0;
                    text-align: center;
                    font-weight: 500;
                `;
                fallbackDiv.innerHTML = `
                    <div style="margin-bottom: 10px;">‚ö†Ô∏è N√£o foi poss√≠vel abrir automaticamente</div>
                    <div style="font-weight: bold;">Use <kbd style="background: #f8f9fa; padding: 2px 6px; border-radius: 4px;">Ctrl+P</kbd> ou <kbd style="background: #f8f9fa; padding: 2px 6px; border-radius: 4px;">Cmd+P</kbd> para imprimir</div>
                `;
                
                const navButtons = document.querySelector('.nav-buttons');
                navButtons.parentNode.insertBefore(fallbackDiv, navButtons);
                
                setTimeout(() => {
                    if (fallbackDiv.parentNode) {
                        fallbackDiv.remove();
                    }
                }, 8000);
            }
        }

        function showValuesScreen() {
            document.getElementById('screen-budget').classList.remove('active');
            document.getElementById('screen-values').classList.add('active');
        }

        function showBudgetScreen() {
            document.getElementById('screen-values').classList.remove('active');
            document.getElementById('screen-budget').classList.add('active');
        }

        function renderValuesTable() {
            renderPapersTable();
            renderMaterialsTable();
            renderPrintingTable();
            renderLaborTable();
        }

        function renderPapersTable() {
            const tbody = document.getElementById('papers-values-table');
            tbody.innerHTML = '';
            
            // Pap√©is Offset
            tbody.innerHTML += '<tr><td colspan="3" style="background: #2c5f5f; color: white; font-weight: bold; text-align: center;">PAP√âIS OFFSET</td></tr>';
            defaultValues.papersOffset.forEach((paper, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="text" value="${paper.name}" onchange="updatePaperOffsetValue(${index}, 'name', this.value)"></td>
                    <td><input type="number" value="${paper.price}" step="0.01" onchange="updatePaperOffsetValue(${index}, 'price', this.value)"></td>
                    <td><button class="btn btn-danger" onclick="removePaperOffsetValue(${index})">üóëÔ∏è</button></td>
                `;
                tbody.appendChild(row);
            });
            
            // Pap√©is Digital
            tbody.innerHTML += '<tr><td colspan="3" style="background: #2c5f5f; color: white; font-weight: bold; text-align: center;">PAP√âIS DIGITAL</td></tr>';
            defaultValues.papersDigital.forEach((paper, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="text" value="${paper.name}" onchange="updatePaperDigitalValue(${index}, 'name', this.value)"></td>
                    <td><input type="number" value="${paper.price}" step="0.01" onchange="updatePaperDigitalValue(${index}, 'price', this.value)"></td>
                    <td><button class="btn btn-danger" onclick="removePaperDigitalValue(${index})">üóëÔ∏è</button></td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderMaterialsTable() {
            const tbody = document.getElementById('materials-values-table');
            tbody.innerHTML = '';
            
            Object.keys(defaultValues.materials).forEach((category, catIndex) => {
                // Linha de cabe√ßalho da categoria
                tbody.innerHTML += `<tr><td colspan="3" style="background: #2c5f5f; color: white; font-weight: bold; text-align: center;">${category}</td></tr>`;
                
                // Linhas de tipos
                const types = defaultValues.materials[category].types;
                Object.keys(types).forEach((typeName, typeIndex) => {
                    const typeData = types[typeName];
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><input type="text" value="${typeName}" onchange="updateMaterialTypeValue('${category}', '${typeName}', 'name', this.value)"></td>
                        <td><input type="number" value="${typeData.price}" step="0.01" onchange="updateMaterialTypeValue('${category}', '${typeName}', 'price', this.value)"></td>
                        <td><button class="btn btn-danger" onclick="removeMaterialTypeValue('${category}', '${typeName}')">üóëÔ∏è</button></td>
                    `;
                    tbody.appendChild(row);
                });
            });
        }
        
        function updateMaterialTypeValue(category, oldTypeName, field, value) {
            const types = defaultValues.materials[category].types;
            
            if (field === 'name' && value !== oldTypeName) {
                // Renomear tipo
                const typeData = types[oldTypeName];
                delete types[oldTypeName];
                types[value] = typeData;
            } else if (field === 'price') {
                types[oldTypeName].price = parseFloat(value);
            }
            
            updateAllSelects();
            renderMaterialsTable();
        }
        
        function removeMaterialTypeValue(category, typeName) {
            delete defaultValues.materials[category].types[typeName];
            
            // Se a categoria ficar sem tipos, remover categoria
            if (Object.keys(defaultValues.materials[category].types).length === 0) {
                delete defaultValues.materials[category];
            }
            
            renderMaterialsTable();
        }

        function renderPrintingTable() {
            const tbody = document.getElementById('printing-values-table');
            tbody.innerHTML = '';
            
            defaultValues.printing.forEach((print, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="text" value="${print.name}" onchange="updatePrintingValue(${index}, 'name', this.value)"></td>
                    <td><input type="number" value="${print.price}" step="0.01" onchange="updatePrintingValue(${index}, 'price', this.value)"></td>
                    <td><button class="btn btn-danger" onclick="removePrintingValue(${index})">üóëÔ∏è</button></td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderLaborTable() {
            const tbody = document.getElementById('labor-values-table');
            tbody.innerHTML = '';
            
            defaultValues.labor.forEach((labor, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="text" value="${labor.name}" onchange="updateLaborValue(${index}, 'name', this.value)"></td>
                    <td><input type="number" value="${labor.hourPrice}" step="0.01" onchange="updateLaborValue(${index}, 'hourPrice', this.value)"></td>
                    <td><button class="btn btn-danger" onclick="removeLaborValue(${index})">üóëÔ∏è</button></td>
                `;
                tbody.appendChild(row);
            });
        }

        function updatePaperOffsetValue(index, field, value) {
            defaultValues.papersOffset[index][field] = field === 'price' ? parseFloat(value) : value;
            updateAllSelects();
        }

        function updatePaperDigitalValue(index, field, value) {
            defaultValues.papersDigital[index][field] = field === 'price' ? parseFloat(value) : value;
            updateAllSelects();
        }



        function updateLaborValue(index, field, value) {
            if (field === 'hourPrice') {
                defaultValues.labor[index].hourPrice = parseFloat(value);
                defaultValues.labor[index].minutePrice = parseFloat(value) / 60;
            } else {
                defaultValues.labor[index][field] = value;
            }
            updateAllSelects();
        }

        function updateAllSelects() {
            // Atualizar todos os selects de papel
            document.querySelectorAll('.paper-select').forEach(select => {
                const currentValue = select.value;
                const technology = document.getElementById('print-technology').value;
                
                let paperOptions = '<option value="">Selecione o papel...</option>';
                if (technology === 'OFFSET') {
                    paperOptions += defaultValues.papersOffset.map(p => 
                        `<option value="${p.name}" data-price="${p.price}">${p.name} - R$ ${p.price.toFixed(2)}</option>`
                    ).join('');
                } else if (technology === 'DIGITAL') {
                    paperOptions += defaultValues.papersDigital.map(p => 
                        `<option value="${p.name}" data-price="${p.price}">${p.name} - R$ ${p.price.toFixed(2)}</option>`
                    ).join('');
                } else {
                    const allPapers = [...defaultValues.papersOffset, ...defaultValues.papersDigital];
                    paperOptions += allPapers.map(p => 
                        `<option value="${p.name}" data-price="${p.price}">${p.name} - R$ ${p.price.toFixed(2)}</option>`
                    ).join('');
                }
                
                select.innerHTML = paperOptions;
                select.value = currentValue;
            });
            
            // Atualizar todos os selects de categoria de material
            document.querySelectorAll('.material-category-select').forEach(select => {
                const currentValue = select.value;
                const materialCategories = Object.keys(defaultValues.materials).map(cat => 
                    `<option value="${cat}">${cat}</option>`
                ).join('');
                select.innerHTML = '<option value="">Selecione o material...</option>' + materialCategories;
                select.value = currentValue;
                
                // Se havia uma categoria selecionada, atualizar os tipos
                if (currentValue && defaultValues.materials[currentValue]) {
                    const row = select.closest('.item-row');
                    const typeSelect = row.querySelector('.material-type-select');
                    const currentType = typeSelect.value;
                    
                    const types = defaultValues.materials[currentValue].types;
                    const typeOptions = Object.keys(types).map(typeName => {
                        const typeData = types[typeName];
                        return `<option value="${typeName}" data-price="${typeData.price}">${typeName} - R$ ${typeData.price.toFixed(2)}</option>`;
                    }).join('');
                    
                    typeSelect.innerHTML = '<option value="">Selecione o tipo...</option>' + typeOptions;
                    typeSelect.disabled = false;
                    typeSelect.value = currentType;
                }
            });
            
            // Atualizar todos os selects de impress√£o
            document.querySelectorAll('.print-select').forEach(select => {
                const currentValue = select.value;
                const printOptions = '<option value="">Selecione o tipo de impress√£o...</option>' +
                    defaultValues.printing.map(p => `<option value="${p.name}" data-price="${p.price}">${p.name} - R$ ${p.price.toFixed(2)}</option>`).join('');
                select.innerHTML = printOptions;
                select.value = currentValue;
            });
            
            // Atualizar todos os selects de m√£o de obra
            document.querySelectorAll('.labor-select').forEach(select => {
                const currentValue = select.value;
                const laborOptions = '<option value="">Selecione o profissional...</option>' +
                    defaultValues.labor.map(l => `<option value="${l.name}" data-hour-price="${l.hourPrice}" data-minute-price="${l.minutePrice}">${l.name} - R$ ${l.hourPrice.toFixed(2)}/h</option>`).join('');
                select.innerHTML = laborOptions;
                select.value = currentValue;
            });
            
            updateCalculations();
        }

        function addNewPaperValue() {
            defaultValues.papersOffset.push({ name: 'Novo Papel Offset', price: 0.10 });
            renderPapersTable();
        }

        function addNewMaterialValue() {
            // Adicionar nova categoria de material
            const newCategoryName = 'Nova Categoria';
            let counter = 1;
            let finalName = newCategoryName;
            
            while (defaultValues.materials[finalName]) {
                finalName = `${newCategoryName} ${counter}`;
                counter++;
            }
            
            defaultValues.materials[finalName] = {
                types: {
                    "Tipo 1": { price: 1.00, hasSizes: false }
                }
            };
            
            renderMaterialsTable();
        }

        function updatePrintingValue(index, field, value) {
            defaultValues.printing[index][field] = field === 'price' ? parseFloat(value) : value;
        }

        function addNewPrintingValue() {
            defaultValues.printing.push({ name: 'Nova Impress√£o', price: 0.25 });
            renderPrintingTable();
        }

        function addNewLaborValue() {
            defaultValues.labor.push({ name: 'Novo Profissional', hourPrice: 30.00, minutePrice: 0.50 });
            renderLaborTable();
        }

        function removePrintingValue(index) {
            defaultValues.printing.splice(index, 1);
            renderPrintingTable();
        }

        function removePaperOffsetValue(index) {
            defaultValues.papersOffset.splice(index, 1);
            renderPapersTable();
        }

        function removePaperDigitalValue(index) {
            defaultValues.papersDigital.splice(index, 1);
            renderPapersTable();
        }



        function removeLaborValue(index) {
            defaultValues.labor.splice(index, 1);
            renderLaborTable();
        }

        async function saveAllValues() {
            const saveButton = document.querySelector('button[onclick="saveAllValues()"]');
            saveButton.classList.add('loading');
            saveButton.textContent = 'üíæ Salvando...';
            
            try {
                // Salvar pap√©is offset
                for (const paper of defaultValues.papersOffset) {
                    const result = await window.dataSdk.create({
                        id: `paper_offset_${paper.name.replace(/\s+/g, '_').toLowerCase()}`,
                        type: 'paper_offset',
                        name: paper.name,
                        unit_price: paper.price,
                        category: 'papers_offset',
                        created_at: new Date().toISOString()
                    });
                    
                    if (!result.isOk) {
                        console.error('Erro ao salvar papel offset:', result.error);
                    }
                }
                
                // Salvar pap√©is digital
                for (const paper of defaultValues.papersDigital) {
                    const result = await window.dataSdk.create({
                        id: `paper_digital_${paper.name.replace(/\s+/g, '_').toLowerCase()}`,
                        type: 'paper_digital',
                        name: paper.name,
                        unit_price: paper.price,
                        category: 'papers_digital',
                        created_at: new Date().toISOString()
                    });
                    
                    if (!result.isOk) {
                        console.error('Erro ao salvar papel digital:', result.error);
                    }
                }
                
                // Salvar materiais (categorias e tipos)
                for (const [category, categoryData] of Object.entries(defaultValues.materials)) {
                    for (const [typeName, typeData] of Object.entries(categoryData.types)) {
                        const result = await window.dataSdk.create({
                            id: `material_${category.replace(/\s+/g, '_').toLowerCase()}_${typeName.replace(/\s+/g, '_').toLowerCase()}`,
                            type: 'material',
                            name: `${category} - ${typeName}`,
                            unit_price: typeData.price,
                            category: 'materials',
                            created_at: new Date().toISOString()
                        });
                        
                        if (!result.isOk) {
                            console.error('Erro ao salvar material:', result.error);
                        }
                    }
                }
                
                // Salvar m√£o de obra
                for (const labor of defaultValues.labor) {
                    const result = await window.dataSdk.create({
                        id: `labor_${labor.name.replace(/\s+/g, '_').toLowerCase()}`,
                        type: 'labor',
                        name: labor.name,
                        unit_price: labor.hourPrice,
                        category: 'labor',
                        created_at: new Date().toISOString()
                    });
                    
                    if (!result.isOk) {
                        console.error('Erro ao salvar m√£o de obra:', result.error);
                    }
                }
                
                // Mostrar mensagem de sucesso
                saveButton.textContent = '‚úÖ Salvo!';
                setTimeout(() => {
                    saveButton.textContent = 'üíæ Salvar Altera√ß√µes';
                    saveButton.classList.remove('loading');
                }, 2000);
                
            } catch (error) {
                console.error('Erro ao salvar valores:', error);
                saveButton.textContent = '‚ùå Erro ao salvar';
                setTimeout(() => {
                    saveButton.textContent = 'üíæ Salvar Altera√ß√µes';
                    saveButton.classList.remove('loading');
                }, 2000);
            }
        }

        function updateValuesFromData(data) {
            // Atualizar valores base com dados salvos
            const papersOffset = data.filter(item => item.type === 'paper_offset');
            const papersDigital = data.filter(item => item.type === 'paper_digital');
            const materials = data.filter(item => item.type === 'material');
            const labor = data.filter(item => item.type === 'labor');
            
            if (papersOffset.length > 0) {
                defaultValues.papersOffset = papersOffset.map(p => ({ name: p.name, price: p.unit_price }));
            }
            
            if (papersDigital.length > 0) {
                defaultValues.papersDigital = papersDigital.map(p => ({ name: p.name, price: p.unit_price }));
            }
            
            if (materials.length > 0) {
                // Reconstruir estrutura de materiais
                const materialsStructure = {};
                materials.forEach(m => {
                    // Espera formato: "Categoria - Tipo"
                    const parts = m.name.split(' - ');
                    if (parts.length === 2) {
                        const [category, typeName] = parts;
                        if (!materialsStructure[category]) {
                            materialsStructure[category] = { types: {} };
                        }
                        materialsStructure[category].types[typeName] = {
                            price: m.unit_price,
                            hasSizes: false
                        };
                    }
                });
                
                if (Object.keys(materialsStructure).length > 0) {
                    defaultValues.materials = materialsStructure;
                }
            }
            
            if (labor.length > 0) {
                defaultValues.labor = labor.map(l => ({ 
                    name: l.name, 
                    hourPrice: l.unit_price, 
                    minutePrice: l.unit_price / 60 
                }));
            }
        }

        // Inicializar aplica√ß√£o
        document.addEventListener('DOMContentLoaded', init);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a07c1a9a5a7e018',t:'MTc2MzQ3MTkzNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
